# 自然语言与语音任务输入方案

## 概述

用自然语言与语音提高任务输入吞吐，支持手机端语音输入、口述式任务模板、自动补全上下文。

## 核心功能

### 1. 手机端语音输入

**功能描述：**
- 手机端支持语音输入
- 将语音转写为文字
- 再结构化为 todo 格式（content/priority/tags/links/due）

**技术方案：**

**方案一：使用浏览器 Web Speech API（推荐）**

**优点：**
- 无需后端
- 无需 API key
- 浏览器原生支持

**缺点：**
- 依赖浏览器支持
- 语音识别质量取决于浏览器

**实现：**
```javascript
const recognition = new webkitSpeechRecognition();
recognition.continuous = true;
recognition.interimResults = true;
recognition.onresult = (event) => {
  const transcript = event.results[event.results.length - 1][0].transcript;
  // 处理语音转写结果
};
```

**方案二：使用 OpenAI Whisper API**

**优点：**
- 语音识别质量高
- 支持多种语言

**缺点：**
- 需要 API key
- 需要后端

**方案三：使用本地 Whisper 模型**

**优点：**
- 隐私保护
- 无需网络

**缺点：**
- 需要下载模型
- 资源消耗大

### 2. 口述式任务模板

**功能描述：**
- 支持"口述式任务模板"
- 例如："高优先级：把 X 文档改成 Y 风格，关联链接 Z，明天前完成"
- 自动解析为结构化 todo

**模板示例：**

**模板一：优先级 + 内容**
```
"高优先级：<任务内容>"
→ Priority: high, Content: <任务内容>
```

**模板二：优先级 + 内容 + 链接**
```
"高优先级：<任务内容>，关联链接 <链接>"
→ Priority: high, Content: <任务内容>, Links: <链接>
```

**模板三：优先级 + 内容 + 截止日期**
```
"高优先级：<任务内容>，明天前完成"
→ Priority: high, Content: <任务内容>, Due: 明天
```

**模板四：完整模板**
```
"高优先级：把 X 文档改成 Y 风格，关联链接 Z，明天前完成"
→ Priority: high
→ Content: 把 X 文档改成 Y 风格
→ Links: Z
→ Due: 明天
```

**解析实现：**

使用自然语言处理（NLP）或正则表达式解析。

**方案一：正则表达式（简单快速）**

```javascript
const patterns = [
  {
    regex: /^(高|中|低)优先级[：:]\s*(.+)$/i,
    handler: (match) => ({
      priority: { '高': 'high', '中': 'medium', '低': 'low' }[match[1]],
      content: match[2]
    })
  },
  {
    regex: /关联链接\s*(.+)$/i,
    handler: (match) => ({ links: match[1] })
  },
  {
    regex: /(.+?)前完成$/i,
    handler: (match) => ({ due: match[1] })
  }
];
```

**方案二：使用 LLM 解析（更智能）**

使用豆包模型解析口述内容，返回结构化 JSON。

### 3. 自动补全上下文

**功能描述：**
- 支持将口述内容自动补全上下文
- 自动带上当前正在编辑的文档路径
- 自动带上最近打开的文件列表

**上下文信息：**

1. **当前正在编辑的文档**
   - 从最近的 git commit 历史提取
   - 从最近的文件操作记录提取

2. **最近打开的文件列表**
   - 记录最近打开/编辑的文件
   - 保留最近 10 个文件

3. **当前正在执行的任务**
   - 从 todos管理系统.md 提取进行中的任务

**实现思路：**

在用户口述任务时，自动添加上下文提示：

```
当前上下文：
- 正在编辑的文档：Notes/AI-Agent-Product&PE.md
- 最近打开的文件：
  - Notes/AI-Agent-Product&PE.md
  - .trae/documents/todos管理系统.md
- 进行中的任务：评估 trae-agent 的能力

用户口述："高优先级：继续完成这个文档"
→ 自动补全为："高优先级：继续完成 Notes/AI-Agent-Product&PE.md 这个文档"
```

## 推荐方案

**推荐方案组合：**
1. 语音输入：使用浏览器 Web Speech API（简单）
2. 口述式任务模板：使用正则表达式（快速）+ LLM 解析（智能）
3. 自动补全上下文：从 git 历史和文件操作记录提取

## 需要用户决策的问题

1. **语音输入方案选择：**
   - 方案一：浏览器 Web Speech API（简单，无需 API key）———— 用户选择
   - 方案二：OpenAI Whisper API（质量高，需要 API key）———— 用户选择
   - 方案三：本地 Whisper 模型（隐私，资源消耗大）———— 用户选择（目前已经具备这一能力，作为兜底项）

2. **口述式任务模板：**
   - 是否需要支持口述式任务模板？———— 用户选择是
   - 需要支持哪些模板？———— LLM自由发挥
   - 是否需要 LLM 智能解析？———— 用户选择是

3. **自动补全上下文：**
   - 是否需要自动补全上下文？———— 用户选择是
   - 需要补全哪些上下文信息？———— LLM自由发挥
   - 上下文信息从哪里获取？———— 从最近的 git commit 历史和文件操作记录提取

4. **移动端集成：**
   - 是作为 Web Manager 的一部分？———— 用户选择是
   - 还是单独的 App？
   - 还是集成到 Lark/飞书？———— Lark/飞书应复用后端能力（用户在飞书和OpenClaw Bot对话）

## 下一步行动

1. 用户确认语音输入方案
2. 用户确认口述式任务模板需求
3. 用户确认自动补全上下文需求
4. 实现语音输入功能
5. 实现口述式任务模板解析
6. 实现自动补全上下文
7. 测试验证
